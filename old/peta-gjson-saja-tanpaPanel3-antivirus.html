<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Explosion Contour - Loading‚Ä¶</title>

  <!-- CSP: izinkan inline style & script (karena file ini single HTML), batasi koneksi eksternal -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src * data:;
                 style-src 'self' 'unsafe-inline' https://unpkg.com;
                 script-src 'self' 'unsafe-inline' https://unpkg.com https://virdanurlulu.github.io;
                 connect-src https://nominatim.openstreetmap.org https://geocoding-api.open-meteo.com;
                 object-src 'none';
                 base-uri 'self';
                 frame-ancestors 'self'">

  <meta name="description" content="Kontur ledakan: impor/ekspor CSV, toolbar mini, localStorage, geodesik, fullscreen, QS read-only, label lokasi Latin.">
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="dns-prefetch" href="//unpkg.com">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <style>
    :root{--ink:#0f172a;--muted:#64748b;--card:#fff;--bg:#f6f8fb}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.45 system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:1200px;margin:auto;padding:16px}
    .card{background:var(--card);border-radius:14px;box-shadow:0 8px 24px rgba(2,8,20,.08);padding:14px}
    h1{font-size:20px;margin:4px 0 12px}
    #map{height:72vh;border-radius:14px;overflow:hidden}
    .legend{position:absolute;z-index:1001;bottom:12px;left:12px;background:#fff;border-radius:10px;
      box-shadow:0 6px 18px rgba(2,8,20,.15);padding:10px 12px;font:14px/1.2 system-ui,Segoe UI,Roboto,Arial}
    .muted{color:var(--muted)}

    /* Fullscreen overlay */
    #mapCard{position:relative}
    .fs-btn{
      position:absolute; z-index:1002; top:12px; right:12px;
      background:rgba(255,255,255,.95); border:1px solid #e5e7eb; border-radius:10px;
      padding:8px 10px; font-weight:700; cursor:pointer; box-shadow:0 4px 12px rgba(2,8,20,.12)
    }
    .fs-btn:active{transform:translateY(1px)}
    .fs-host.fullscreen{position:fixed; inset:0; z-index:9999; margin:0; border-radius:0; padding:0; background:#000;}
    .fs-host.fullscreen #map{height:100dvh; height:100vh; border-radius:0}
    body.fs-lock{overflow:hidden}

    /* Toolbar mini */
    .toolbar{
      position:absolute; z-index:1002; top:12px; left:12px;
      background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 6px 18px rgba(2,8,20,.14);
      display:flex; align-items:center; gap:8px; padding:8px 10px; flex-wrap:wrap
    }
    .tb-btn{border:1px solid #e5e7eb; background:#fff; border-radius:10px; padding:8px 10px; cursor:pointer; font-weight:700}
    .tb-btn:hover{background:#f8fafc}
    .tb-input{width:120px; padding:8px 10px; border:1px solid #e5e7eb; border-radius:10px}
    .tb-select{padding:8px 10px; border:1px solid #e5e7eb; border-radius:10px}
    .sep{width:1px; height:28px; background:#e5e7eb; margin:0 2px}
    .notice{font-size:12px; color:#64748b}

    /* Hindari tumpang tindih kontrol Leaflet saat awal load */
    #map .leaflet-top.leaflet-left{ margin-top:64px; }

    /* Label nama daerah */
    .placelabel{
      background:rgba(255,255,255,.95);
      color:#0f172a; border:1px solid #e5e7eb; border-radius:8px;
      box-shadow:0 2px 8px rgba(2,8,20,.12); padding:4px 6px; font-weight:600
    }

    /* Tebalkan kredit */
    .leaflet-control-attribution span[title="Author"]{ font-weight:600; }

    /* Tombol fullscreen mobile */
    .fs-btn-mobile{ display:none; bottom:56px; right:12px; left:auto; top:auto; }

    /* ====== Responsif (selular) ====== */
    @media (max-width:640px){
      body{ font-size:14px; }
      h1{ font-size:18px; }
      .toolbar{ gap:6px; padding:6px 8px; }
      .tb-btn,.tb-input,.tb-select{ padding:6px 8px; border-radius:9px; }
      .tb-input{ width:110px; }
      .legend{ font-size:12px; padding:8px 10px; }
      #fsBtn{ display:none; }              /* sembunyikan tombol desktop */
      #fsBtnMobile{ display:inline-flex; } /* tampilkan tombol mobile */
      #map .leaflet-top.leaflet-left{ margin-top:56px; }
      .legend .details{ display:none; }    /* sembunyikan baris parameter di legend */
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 id="pageTitle">Explosion Contour - Loading‚Ä¶</h1>

    <div class="card fs-host" id="mapCard">
      <!-- Fullscreen desktop -->
      <button id="fsBtn" class="fs-btn" aria-pressed="false" title="Fullscreen (F)">‚õ∂ Fullscreen</button>
      <!-- Fullscreen mobile (muncul otomatis di layar kecil) -->
      <button id="fsBtnMobile" class="fs-btn fs-btn-mobile" aria-pressed="false" title="Fullscreen">‚õ∂ Fullscreen</button>

      <!-- Toolbar mini -->
      <div class="toolbar" role="region" aria-label="Kontrol peta">
        <button id="btnPlay"   class="tb-btn" title="Play/Pause (Spasi)">‚ñ∂ Play</button>
        <button id="btnImport" class="tb-btn" title="Impor CSV rings (r,Po) ‚Äî bisa sertakan baris pusat lat,lon">‚¨Ü Import CSV</button>
        <input id="fileIn" type="file" accept=".csv,text/csv" hidden>
        <button id="btnExport" class="tb-btn" title="Ekspor dataset saat ini ke CSV">‚¨á Export CSV</button>
        <span class="sep" aria-hidden="true"></span>
        <label class="notice" for="palSel">Palette</label>
        <select id="palSel" class="tb-select" aria-label="Pilih palette">
          <option value="bright">Cerah</option>
          <option value="bluegreen">Biru‚ÄìHijau</option>
          <option value="heat">Heat</option>
        </select>
        <span class="sep" aria-hidden="true"></span>
        <button id="btnLabel" class="tb-btn" title="Tampilkan/sembunyikan label daerah di marker pusat">üëÅ Label: On</button>
        <span class="sep" aria-hidden="true"></span>
        <label class="notice" for="latIn">Lat</label>
        <input id="latIn" class="tb-input" type="number" step="any" aria-label="Latitude">
        <label class="notice" for="lonIn">Lon</label>
        <input id="lonIn" class="tb-input" type="number" step="any" aria-label="Longitude">
        <button id="btnApplyCoord" class="tb-btn" title="Terapkan koordinat">‚úî Apply</button>
      </div>

      <div id="map" role="region" aria-label="Peta kontur ledakan"></div>
      <div class="legend" id="legend" hidden></div>
    </div>
  </div>

  <!-- Script eksternal -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://virdanurlulu.github.io/js/script_exp_contour.js"></script>
</body>
</html>
