<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulation & Modeling of Explosion Effects (TNT Equivalence)</title>
 
  <link rel="stylesheet" type="text/css" href="/css/style1.css">
  
  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/virdanurlulu/virdanurlulu.github.io/refs/heads/main/img/favicon.ico">
  <link rel="canonical" href="https://virdanurlulu.github.io/">
  <link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>
  <link rel="dns-prefetch" href="//raw.githubusercontent.com">
  <link rel="preload" as="image" href="https://raw.githubusercontent.com/virdanurlulu/virdanurlulu.github.io/refs/heads/main/img/banner-itb1.webp">

  <meta name="description" content="Interactive simulation and modeling of explosion effects based on TNT equivalence using JavaScript — with chemical materials, properties, and consequence estimation.">
  <meta name="author" content="Virda Nur Lu'lu">
  <meta name="robots" content="index,follow">
  <meta name="theme-color" content="#0079c2">
  <meta name="color-scheme" content="light dark">

  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Program Magister Teknik Kimia — Institut Teknologi Bandung">
  <meta property="og:title" content="Simulation and Modeling of Explosion Effects Based on TNT Equivalence using Javascript">
  <meta property="og:description" content="Interactive explosion-effects modeling (TNT equivalence). Chemical materials, properties, parameters, and consequence estimation.">
  <meta property="og:url" content="https://virdanurlulu.github.io/">
  <meta property="og:image" content="https://raw.githubusercontent.com/virdanurlulu/virdanurlulu.github.io/refs/heads/main/img/ITB-Exlosion-Modeling-Simulation.webp">
  <meta property="og:image:type" content="image/webp">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Simulation and Modeling of Explosion Effects Based on TNT Equivalence using Javascript">
  <meta name="twitter:description" content="Interactive explosion-effects modeling (TNT equivalence). Chemical materials, properties, parameters, and consequence estimation.">
  <meta name="twitter:image" content="https://raw.githubusercontent.com/virdanurlulu/virdanurlulu.github.io/refs/heads/main/img/ITB-Exlosion-Modeling-Simulation.webp">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Explosion Effects Modeling (TNT Equivalence)",
    "applicationCategory": "EducationalApplication",
    "operatingSystem": "Web",
    "url": "https://virdanurlulu.github.io/",
    "image": "https://raw.githubusercontent.com/virdanurlulu/virdanurlulu.github.io/refs/heads/main/img/ITB-Exlosion-Modeling-Simulation.webp",
    "author": {"@type": "Person", "name": "Virda Nur Lu'lu", "sameAs": ["https://id.linkedin.com/in/virdanurlulu"]},
    "inLanguage": "en",
    "description": "Interactive simulation and modeling of explosion effects based on TNT equivalence using JavaScript — with chemical materials, properties, and consequence estimation.",
    "publisher": {"@type": "Organization", "name": "Institut Teknologi Bandung", "url": "https://che.itb.ac.id/"}
  }
  </script>
  </head>
<body class="theme-itb full">
  <div class="wrap">
    <div class="banner title">
      <div class="brandbar">
        <a href="https://virdanurlulu.github.io/" target="_blank" rel="noopener noreferrer" class="brand-logo-link" aria-label="Kunjungi beranda">
          <img id="itbLogo" class="brand-logo" alt="Logo ITB" width="96" height="96" decoding="async" fetchpriority="high"
               src="https://raw.githubusercontent.com/virdanurlulu/virdanurlulu.github.io/refs/heads/main/img/Logo_Institut_Teknologi_Bandung.webp"/>
        </a>
        <div class="brand-text">
          <h1>Simulation and Modeling of Explosion Effects Based on TNT Equivalence <span class="nowrap">using Javascript</span></h1>
          <h2>Program Magister Teknik Kimia  -  Institut Teknologi Bandung</h2>
        </div>
      </div>
    </div>

    <main class="split" role="main">
      <div class="left">
        <section class="card" aria-labelledby="mat-head">
          <div id="mat-head" class="card-header">Chemical Material</div>
          <div style="padding:14px">
            <div class="chem-grid">
              <div class="matcol">
                <div>
                  <label for="material" class="label">Pilih Material</label>
                  <select id="material">
                    <option value="">— pilih —</option>
                    <option value="AN">Ammonium Nitrate (AN)</option>
                    <option value="LPG">Liquefied Petroleum Gas (LPG)</option>
                    <option value="H2">Hydrogen (H₂)</option>
                    <option value="TNT">TNT (referensi)</option>
                  </select>
                </div>
                <div class="mini">
                  <div>
                    <label for="vol" class="label">Volume</label>
                    <div class="input-group">
                      <input id="vol" type="number" min="0" step="any" placeholder="cth 12.5" aria-label="Volume" />
                      <span class="unit">m³</span>
                    </div>
                  </div>
                  <div>
                    <label for="dist" class="label">Distance</label>
                    <div class="input-group">
                      <input id="dist" type="number" min="0" step="any" placeholder="cth 150" aria-label="Distance" />
                      <span class="unit">meters</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="eq-panel">
                <div class="eq-title">Representative Overall Reaction (Energy Basis)</div>
                <div id="eq-text" class="eq-body">Pilih material untuk menampilkan persamaan reaksi representatif.</div>
                <div class="eq-note">Catatan: Persamaan berikut bersifat <em>overall/representative</em> untuk tujuan neraca energi; komposisi produk nyata bergantung pada kondisi (tekanan, temperatur, oksigen, confinement).</div>
              </div>
            </div>
          </div>
        </section>

        <section class="card" aria-labelledby="prop-head">
          <div id="prop-head" class="card-header">Properties</div>
          <div style="padding:12px">
            <table>
              <thead>
                <tr>
                  <th style="width:36%">Properties</th>
                  <th style="width:22%">Value</th>
                  <th style="width:12%">Unit</th>
                  <th>Literature</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><label for="rho" class="label">Density ρ = m/V</label></td>
                  <td><input id="rho" type="number" min="0" step="any" placeholder="kg/m³"/></td>
                  <td class="unit">kg/m³</td>
                  <td class="ref">@Literature, NIST</td>
                </tr>
                <tr>
                  <td><label for="dh" class="label">ΔH<sub>explosion</sub></label></td>
                  <td><input id="dh" type="number" min="0" step="any" placeholder="kJ/kg"/></td>
                  <td class="unit">kJ/kg</td>
                  <td class="ref">@Literature, NIST</td>
                </tr>
                <tr>
                  <td><label for="pa" class="label">(kPa) Ambient Pressure</label></td>
                  <td><input id="pa" type="number" min="0" step="any" placeholder="101.325"/></td>
                  <td class="unit">kPa</td>
                  <td class="ref">@Literature, NIST @20&nbsp;°C</td>
                </tr>
                <tr>
                  <td><label for="eta" class="label">η<sub>E</sub> Explosion Efficiency</label></td>
                  <td><input id="eta" type="number" min="0" max="1" step="any" placeholder="0–1"/></td>
                  <td class="unit">–</td>
                  <td class="ref">@Literature, Crowl &amp; Louvar; Alonso; Sadovski</td>
                </tr>
                <tr>
                  <td><label for="e_tnt" class="label">E<sub>TNT</sub></label></td>
                  <td><input id="e_tnt" type="number" min="0" step="any" placeholder="kJ/kg"/></td>
                  <td class="unit">kJ/kg</td>
                  <td class="ref">@Literature, Crowl &amp; Louvar; Alonso; Sadovski</td>
                </tr>
              </tbody>
            </table>
            <div class="footnote">Catatan: Nilai default tidak diisikan agar Anda memasukkan referensi yang tepat. Form ini hanya memfasilitasi perhitungan berdasarkan input Anda.</div>
          </div>
        </section>

        <section class="card" aria-labelledby="param-head">
          <div id="param-head" class="card-header">Parameters</div>
          
          <div style="padding:12px">
            <table id="paramTable">
              <thead>
                <tr>
                  <th style="width:36%">Parameters</th>
                  <th style="width:22%">Value</th>
                  <th style="width:12%">Unit</th>
                  <th>Sources</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="label">(W) Mass Material</td>
                  <td><input id="W_mass" type="number" readonly /></td>
                  <td class="unit">kg</td>
                  <td class="ref">@CCPS, Crowl &amp; Louvar</td>
                </tr>
                <tr>
                  <td class="label">(E) Total Energy</td>
                  <td><input id="E_total" type="number" readonly /></td>
                  <td class="unit">kJ</td>
                  <td class="ref">@CCPS, Crowl &amp; Louvar</td>
                </tr>
                <tr>
                  <td class="label">(W) TNT Equivalent</td>
                  <td><input id="W_tnt" type="number" readonly /></td>
                  <td class="unit">kg</td>
                  <td class="ref">@CCPS, Crowl &amp; Louvar</td>
                </tr>
                <tr>
                  <td class="label">(Ze) Scaled Distance</td>
                  <td><input id="Ze" type="number" readonly /></td>
                  <td class="unit">m·kg<sup>−1/3</sup></td>
                  <td class="ref">@Crowl &amp; Louvar</td>
                </tr>
                <tr>
                  <td class="label">(Po/Pa) Overpressure Ratio</td>
                  <td><input id="Ps" type="text" readonly placeholder="—"/></td>
                  <td class="unit">–</td>
                  <td class="ref">@Crowl &amp; Louvar</td>
                </tr>
                <tr>
                  <td class="label">(Po) Peak side‑on Overpressure Crowl</td>
                  <td><input id="Po_crowl" type="text" readonly placeholder="—"/></td>
                  <td class="unit">kPa</td>
                  <td class="ref">@Crowl method</td>
                </tr>
                <tr>
                  <td class="label">(Po) Peak side‑on Overpressure Alonso</td>
                  <td><input id="Po_alonso" type="text" readonly placeholder="—"/></td>
                  <td class="unit">kPa</td>
                  <td class="ref">@Alonso method</td>
                </tr>
                <tr>
                  <td class="label">(Po) Peak side‑on Overpressure Sadovski</td>
                  <td><input id="Po_sadovski" type="text" readonly placeholder="—"/></td>
                  <td class="unit">kPa</td>
                  <td class="ref">@Sadovski method</td>
                </tr>
              </tbody>
            </table>
            <div id="msg" class="status" role="status" aria-live="polite"></div>
            <div class="footnote">Perhitungan otomatis diaktifkan: <code class="badge">W = ρ · V</code>, <code class="badge">E = W · ΔH · η<sub>E</sub></code>, <code class="badge">W<sub>TNT</sub> = E / E<sub>TNT</sub></code>, <code class="badge">Ze = R / (W<sub>TNT</sub>)<sup>1/3</sup></code>, serta <code class="badge">Ps, Po</code> menggunakan korelasi aproksimasi berbasis kurva. Mohon validasi parameter & referensi Anda saat publikasi.</div>
          </div>
        </section>
      </div>
      <aside class="right">
        <section class="card estimation" aria-labelledby="est-damage">
          <div id="est-damage" class="card-header">Estimation of Damage Structure and Process Equipment</div>
          <div class="method-grid">
            <div class="method-card">
              <div class="vlabel">CROWL</div>
              <div class="pad" id="panel-damage-crowl" aria-label="Crowl damage panel">
                <p><strong>Overpressure (Po):</strong> <span id="val-Po-crowl">—</span> kPa</p>
                <p><strong>Efek:</strong></p>
                <ul id="effects-crowl" style="padding-left: 20px;">
                  <li>Kerusakan ringan pada jendela kaca (1.4 kPa)</li>
                </ul>
              </div>
              <div class="sevfoot" id="sev-crowl">Unknown</div>
            </div>
            <div class="method-card">
              <div class="vlabel">ALONSO</div>
              <div class="pad" id="panel-damage-alonso" aria-label="Alonso damage panel">
                <p><strong>Overpressure (Po):</strong> <span id="val-Po-alonso">—</span> kPa</p>
                <p><strong>Efek:</strong></p>
                <ul id="effects-alonso" style="padding-left: 20px;">
                  <li>Kerusakan atap, dinding, dan jendela (7 kPa)</li>
                </ul>
              </div>
              <div class="sevfoot" id="sev-alonso">Unknown</div>
            </div>
            <div class="method-card">
              <div class="vlabel">SADOVSKI</div>
              <div class="pad" id="panel-damage-sadovski" aria-label="Sadovski damage panel">
                <p><strong>Overpressure (Po):</strong> <span id="val-Po-sadovski">—</span> kPa</p>
                <p><strong>Efek:</strong></p>
                <ul id="effects-sadovski" style="padding-left: 20px;">
                  <li>Pecah jendela kaca (7 kPa)</li>
                </ul>
              </div>
              <div class="sevfoot" id="sev-sadovski">Unknown</div>
            </div>
          </div>
        </section>
        <section class="card estimation" aria-labelledby="est-injury">
          <div id="est-injury" class="card-header">Estimation of Injury Consequences</div>
          <div class="method-grid">
            <div class="method-card">
              <div class="vlabel">CROWL</div>
              <div class="pad" id="panel-injury-crowl" aria-label="Crowl injury panel">
                <p><strong>Overpressure (Po):</strong> <span id="val-Po-crowl-inj">—</span> kPa</p>
                <p><strong>Efek:</strong></p>
                <ul id="injury-effects-crowl" style="padding-left: 20px;">
                  <li>Luka-luka kecil (14 kPa)</li>
                </ul>
              </div>
              <div class="sevfoot" id="sev-injury-crowl">Unknown</div>
            </div>
            <div class="method-card">
              <div class="vlabel">ALONSO</div>
              <div class="pad" id="panel-injury-alonso" aria-label="Alonso injury panel">
                <p><strong>Overpressure (Po):</strong> <span id="val-Po-alonso-inj">—</span> kPa</p>
                <p><strong>Efek:</strong></p>
                <ul id="injury-effects-alonso" style="padding-left: 20px;">
                   <li>Luka ringan (7 kPa)</li>
                </ul>
              </div>
              <div class="sevfoot" id="sev-injury-alonso">Unknown</div>
            </div>
            <div class="method-card">
              <div class="vlabel">SADOVSKI</div>
              <div class="pad" id="panel-injury-sadovski" aria-label="Sadovski injury panel">
                <p><strong>Overpressure (Po):</strong> <span id="val-Po-sadovski-inj">—</span> kPa</p>
                <p><strong>Efek:</strong></p>
                <ul id="injury-effects-sadovski" style="padding-left: 20px;">
                  <li>Luka-luka (14 kPa)</li>
                </ul>
              </div>
              <div class="sevfoot" id="sev-injury-sadovski">Unknown</div>
            </div>
          </div>
        </section>
      </aside>
    </main>

    <footer class="app-footer" role="contentinfo">
      <div class="grid">
        <div>
          <div class="credit">Copyright (c) 2025 by <a href="https://id.linkedin.com/in/virdanurlulu" target="_blank" rel="nofollow">Virda Nur Lu'lu</a></div>
          <div class="dedication">This application is dedicated to my parents, whose persistent support and patient guidance throughout my journey with JavaScript. It is also presented to the academic community at <a href="https://che.itb.ac.id/" target="_blank" rel="nofollow">Institut Teknologi Bandung</a> as a contribution towards inspiring further advancements in JavaScript technology.</div>
        </div>
        <div class="actions">
          <a class="btn primary" href="https://virdanurlulu.github.io/" target="_blank" rel="noopener noreferrer">Home</a>
          <button class="btn" id="toTop" type="button">Back to top</button>
        </div>
      </div>
    </footer>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const fields = ['rho','vol','dh','eta','e_tnt','dist','pa'];

    // ---- Logo loader with multiple fallbacks ----
    const logoCandidates = [
      'https://raw.githubusercontent.com/virdanurlulu/virdanurlulu.github.io/refs/heads/main/img/Logo_Institut_Teknologi_Bandung.webp'
    ];
    function loadLogo(){
      const img = document.getElementById('itbLogo');
      if(!img) return;
      let i = 0;
      const fallbackData = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256"><circle cx="128" cy="128" r="120" fill="%230079c2"/><text x="50%" y="56%" font-family="Georgia, serif" font-size="88" text-anchor="middle" fill="white">ITB</text></svg>';
      const tryNext = ()=>{
        if(i >= logoCandidates.length){ img.onerror=null; img.src = fallbackData; return; }
        const url = logoCandidates[i++] + (logoCandidates[i-1].includes('?') ? '' : '?v=1');
        img.onerror = tryNext;
        img.src = url;
      };
      tryNext();
    }

    // Back to top
    function goTop(){ try{ window.scrollTo({top:0, behavior:'smooth'}); }catch(e){ window.scrollTo(0,0);} }

    // Estimation Panels
    const updateEstimationPanels = (PoCrowl, PoAlonso, PoSadovski) => {
      const getSeverity = (Po) => {
        if (Po >= 70) return 'Major';
        if (Po >= 35) return 'Serious';
        if (Po >= 14) return 'Moderate';
        if (Po >= 1.4) return 'Minor';
        return 'Unknown';
      };

      const updatePanel = (method, Po) => {
        const sevFoot = $(`sev-${method}`);
        const sevFootInjury = $(`sev-injury-${method}`);
        const effectsDamageEl = $(`effects-${method}`);
        const effectsInjuryEl = $(`injury-effects-${method}`);

        const damageEffects = {
          'crowl': [
            { threshold: 276, text: 'Dinding beton bertulang hancur' },
            { threshold: 34.5, text: 'Kerusakan total pada bangunan non-permanen' },
            { threshold: 7, text: 'Kerusakan struktural parsial pada bangunan' },
            { threshold: 1.4, text: 'Kerusakan ringan pada jendela kaca' }
          ],
          'alonso': [
            { threshold: 70, text: 'Kerusakan total pada bangunan industri' },
            { threshold: 35, text: 'Kerusakan parah pada bangunan' },
            { threshold: 21, text: 'Kerusakan besar pada pabrik kimia' },
            { threshold: 7, text: 'Kerusakan atap, dinding, dan jendela' }
          ],
          'sadovski': [
            { threshold: 70, text: 'Bangunan hancur total' },
            { threshold: 35, text: 'Dinding runtuh' },
            { threshold: 14, text: 'Kerusakan struktural ringan' },
            { threshold: 7, text: 'Pecah jendela kaca' }
          ]
        };

        const injuryEffects = {
          'crowl': [
            { threshold: 70, text: 'Kematian 50%' },
            { threshold: 34.5, text: 'Gendang telinga pecah' },
            { threshold: 28, text: 'Luka berat dan mematikan' },
            { threshold: 14, text: 'Luka-luka kecil' }
          ],
          'alonso': [
            { threshold: 70, text: 'Kematian' },
            { threshold: 35, text: 'Cedera serius/fatal' },
            { threshold: 21, text: 'Gendang telinga pecah' },
            { threshold: 7, text: 'Luka ringan' }
          ],
          'sadovski': [
            { threshold: 70, text: 'Kematian' },
            { threshold: 35, text: 'Gendang telinga pecah' },
            { threshold: 28, text: 'Luka serius/fatal' },
            { threshold: 14, text: 'Luka-luka' }
          ]
        };

        if (isNaN(Po)) {
          const elA = $(`val-Po-${method}`);
          const elB = $(`val-Po-${method}-inj`);
          if (elA) elA.textContent = '—';
          if (elB) elB.textContent = '—';
          if (sevFoot) { sevFoot.textContent = 'Unknown'; sevFoot.className = 'sevfoot Unknown'; }
          if (sevFootInjury) { sevFootInjury.textContent = 'Unknown'; sevFootInjury.className = 'sevfoot Unknown'; }
          if (effectsDamageEl) effectsDamageEl.innerHTML = '<li>Menunggu input...</li>';
          if (effectsInjuryEl) effectsInjuryEl.innerHTML = '<li>Menunggu input...</li>';
          return;
        }

        const severity = getSeverity(Po);
        const pretty = Po.toLocaleString('id-ID',{maximumFractionDigits:2});

        const elA = $(`val-Po-${method}`);
        const elB = $(`val-Po-${method}-inj`);
        if (elA) elA.textContent = pretty;
        if (elB) elB.textContent = pretty;

        sevFoot.textContent = severity;
        sevFootInjury.textContent = severity;
        sevFoot.className = `sevfoot ${severity}`;
        sevFootInjury.className = `sevfoot ${severity}`;

        // Dynamically update effect lists
        const applicableDamage = damageEffects[method].filter(e => Po >= e.threshold);
        const applicableInjury = injuryEffects[method].filter(e => Po >= e.threshold);

        if (effectsDamageEl) {
          effectsDamageEl.innerHTML = applicableDamage.length > 0
            ? applicableDamage.map(e => `<li style="color:var(--ink);">${e.text} (${e.threshold} kPa)</li>`).join('')
            : '<li style="color:var(--ink);">Tidak ada efek signifikan pada level ini.</li>';
        }
        if (effectsInjuryEl) {
          effectsInjuryEl.innerHTML = applicableInjury.length > 0
            ? applicableInjury.map(e => `<li style="color:var(--ink);">${e.text} (${e.threshold} kPa)</li>`).join('')
            : '<li style="color:var(--ink);">Tidak ada efek signifikan pada level ini.</li>';
        }
      };

      updatePanel('crowl', PoCrowl);
      updatePanel('alonso', PoAlonso);
      updatePanel('sadovski', PoSadovski);
    };

    const calculateValues = () => {
      const rho = parseFloat($("rho").value);
      const vol = parseFloat($("vol").value);
      const dh = parseFloat($("dh").value);
      const eta = parseFloat($("eta").value);
      const e_tnt = parseFloat($("e_tnt").value);
      const dist = parseFloat($("dist").value);
      const pa = parseFloat($("pa").value);

      const resetAll = (msgText, bad=true) => {
        ["W_mass","E_total","W_tnt","Ze","Ps","Po_crowl","Po_alonso","Po_sadovski"].forEach(id=> $(id).value = "");
        const msg = $("msg");
        msg.classList.toggle('bad', !!bad);
        msg.textContent = msgText;
        msg.style.display = 'block';
        updateEstimationPanels(NaN, NaN, NaN);
      };

      const isAnyInputFilled = fields.some(id => $(id).value !== "");
      if (!isAnyInputFilled) {
          $("msg").style.display = 'none';
          updateEstimationPanels(NaN, NaN, NaN);
          return;
      }

      if (isNaN(rho) || isNaN(vol) || isNaN(dh) || isNaN(eta) || isNaN(e_tnt) || isNaN(dist) || isNaN(pa)) {
        return resetAll('Harap isi semua properti yang dibutuhkan.');
      }

      const clamp01 = (x)=> isNaN(x) ? NaN : Math.max(0, Math.min(1, x));
      const _eta = clamp01(eta);

      const W_mass = rho * vol;
      const E_total = W_mass * dh * _eta;

      if (!(e_tnt > 0) || !(E_total > 0)) {
        return resetAll('Periksa kembali ΔH, η, dan E_TNT (harus > 0).');
      }

      const W_tnt = E_total / e_tnt;
      if (!(W_tnt > 0)) {
        return resetAll('W_TNT tidak valid. Sesuaikan parameter.');
      }

      const Ze = dist > 0 ? (dist / Math.cbrt(W_tnt)) : NaN;
      if (!Number.isFinite(Ze) || Ze <= 0) {
        return resetAll('Jarak harus > 0 dan W_TNT masuk akal untuk menghitung Ze.');
      }

      $("W_mass").value = W_mass.toFixed(2);
      $("E_total").value = E_total.toFixed(2);
      $("W_tnt").value = W_tnt.toFixed(2);
      $("Ze").value = Ze.toFixed(4);

      // Crowl method
      const computeOverpressureCrowl = (Ze) => {
        const numerator = 1616 * (1 + Math.pow(Ze / 4.5, 2));
        const term1_den = Math.sqrt(1 + Math.pow(Ze / 0.048, 2));
        const term2_den = Math.sqrt(1 + Math.pow(Ze / 0.32, 2));
        const term3_den = Math.sqrt(1 + Math.pow(Ze / 1.35, 2));
        const denominator = term1_den * term2_den * term3_den;
        return numerator / denominator;
      }
      
      // Alonso method
      const computeOverpressureAlonso = (Ze) => {
        if (Ze >= 1 && Ze < 10) return 1.13 * Math.pow(10, 6) * Math.pow(Ze, -2.01);
        if (Ze >= 10 && Ze <= 200) return 1.83 * Math.pow(10, 5) * Math.pow(Ze, -1.16);
        return NaN;
      }
      
      // Sadovski method
      const computeOverpressureSadovski = (W_tnt, dist) => {
        if (dist > 0 && W_tnt > 0) {
          const ratioTerm = Math.cbrt(W_tnt) / dist;
          return 0.085 * ratioTerm + 0.3 * Math.pow(ratioTerm, 2) + 0.8 * Math.pow(ratioTerm, 3);
        }
        return NaN;
      }

      const PoPa_crowl = computeOverpressureCrowl(Ze);
      const Po_crowl = PoPa_crowl * pa; 
      
      // Rumus Alonso menghasilkan Pa, konversi ke kPa (/1000)
      const Po_alonso = computeOverpressureAlonso(Ze) / 1000;
      
      // Rumus Sadovski menghasilkan MPa, konversi ke kPa (*1000)
      const Po_sadovski = computeOverpressureSadovski(W_tnt, dist) * 1000; 

      $("Ps").value = PoPa_crowl.toFixed(4);
      $("Po_crowl").value = Po_crowl.toFixed(2);
      $("Po_alonso").value = isNaN(Po_alonso) ? '' : Po_alonso.toFixed(2);
      $("Po_sadovski").value = isNaN(Po_sadovski) ? '' : Po_sadovski.toFixed(2);

      updateEstimationPanels(Po_crowl, Po_alonso, Po_sadovski);
      
      const msg = $("msg");
      msg.classList.remove('bad');
      msg.textContent = "Perhitungan berhasil diselesaikan.";
      msg.style.display = 'block';
    };

    function compute() {
      if ($('pa').value === '' || isNaN(parseFloat($('pa').value))) {
          $('pa').value = '101.325';
      }
      calculateValues();
    }

    const presets = {
      AN:  { rho: 1725, dh: 2479,  e_tnt: 4500, eta: 0.35  },
      LPG: { rho: 37,   dh: 50000, e_tnt: 4500, eta: 0.03 },
      H2:  { rho: 0.08375, dh: 130800,e_tnt: 4500, eta: 0.05 },
      TNT: { rho: 1600, dh: 4184,  e_tnt: 4184, eta: 1.0   }
    };

    const eqMap = {
      AN: [
        {label:'Thermal decomposition (sub‑detonation)', eq:'NH<sub>4</sub>NO<sub>3</sub>(s) <span class="arrow">→</span> N<sub>2</sub>O(g) + 2 H<sub>2</sub>O(g)'},
        {label:'Detonation (oxygen‑balanced approx.)', eq:'2 NH<sub>4</sub>NO<sub>3</sub>(s) <span class="arrow">→</span> 2 N<sub>2</sub>(g) + O<sub>2</sub>(g) + 4 H<sub>2</sub>O(g)'}
      ],
      LPG: [ {label:'Combustion proxy (propane)', eq:'C<sub>3</sub>H<sub>8</sub>(g) + 5 O<sub>2</sub>(g) <span class="arrow">→</span> 3 CO<sub>2</sub>(g) + 4 H<sub>2</sub>O(g)'} ],
      H2: [ {label:'Combustion/explosion', eq:'2 H<sub>2</sub>(g) + O<sub>2</sub>(g) <span class="arrow">→</span> 2 H<sub>2</sub>O(g)'} ],
      TNT: [ {label:'Detonation (oxygen‑deficient, typical overall)', eq:'2 C<sub>7</sub>H<sub>5</sub>N<sub>3</sub>O<sub>6</sub>(s) <span class="arrow">→</span> 3 N<sub>2</sub>(g) + 5 H<sub>2</sub>O(g) + 7 CO(g) + 7 C(s)'} ]
    };

    function renderEquation(material){
      const box = $('eq-text');
      if (!box) return;
      if (!material || !eqMap[material]){ box.innerHTML = 'Pilih material untuk menampilkan persamaan reaksi representatif.'; return; }
      const html = eqMap[material].map(item=>`<div class="rxn"><small>${item.label}</small><div class="rxn-eq">${item.eq}</div></div>`).join('');
      box.innerHTML = html;
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadLogo();

      $('toTop')?.addEventListener('click', goTop);

      fields.forEach(id=> $(id)?.addEventListener('input', compute));

      const materialSel = $("material");
      if (materialSel){
        materialSel.addEventListener('change', (e)=>{
          const p = presets[e.target.value];
          if (p){
            $("rho").value = p.rho;  $("dh").value = p.dh; $("e_tnt").value = p.e_tnt; $("eta").value = p.eta;
            compute();
          }
          renderEquation(e.target.value);
          const msg = $("msg");
          msg.classList.remove('bad');
          msg.textContent = 'Nilai contoh diisikan untuk pratinjau. Ganti dengan nilai dari literatur Anda.';
          msg.style.display = 'block';
        });
      }

      compute(); // Initial compute
    });
  </script>
</body>
</html>
